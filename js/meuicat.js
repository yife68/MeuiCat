let rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height(),domhref="",domImgSrc="",globalEvent=null;var selectTextNow="",icat={imageToBlob:function(e){const t=new Image,n=document.createElement("canvas"),o=n.getContext("2d");return t.crossOrigin="",t.src=e,new Promise((e=>{t.onload=function(){n.width=this.naturalWidth,n.height=this.naturalHeight,o.drawImage(this,0,0),n.toBlob((t=>{e(t)}),"image/png",.75)}}))},copyImage:async function(e){const t=await icat.imageToBlob(e),n=new ClipboardItem({"image/png":t});navigator.clipboard.write([n])},stopMaskScroll:function(){document.getElementById("rightMenu-mask")&&document.getElementById("rightMenu-mask").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),!1),document.getElementById("rightMenu")&&document.getElementById("rightMenu").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),!1)},addRightMenuClickEvent:function(){$("#rightMenu-mask").on("click",rm.hideRightMenu),$("#rightMenu-mask").contextmenu((function(){return rm.hideRightMenu(),!1})),$("#menu-backward").on("click",(function(){window.history.back(),rm.hideRightMenu()})),$("#menu-forward").on("click",(function(){window.history.forward(),rm.hideRightMenu()})),$("#menu-refresh").on("click",(function(){rm.hideRightMenu(),window.location.reload()})),$("#menu-darkmode").on("click",rm.switchDarkMode),$("#menu-reading").on("click",rm.switchReadMode),$("#menu-commentBarrage").on("click",(function(){rm.hideRightMenu(),rm.switchCommentBarrage()})),$("#menu-postlink").on("click",rm.copyPostUrl),$("#menu-copytext").on("click",(function(){rm.rightmenuCopyText(selectTextNow),btf.snackbarShow("复制成功，复制和转载请标注本文地址")})),$("#menu-pastetext").on("click",rm.pasteText),$("#menu-commenttext").on("click",(function(){meuicat.commentText(selectTextNow),rm.hideRightMenu()})),$("#menu-searchBaidu").on("click",rm.searchBaidu),$("#menu-newwindow").on("click",(function(){window.open(domhref),rm.hideRightMenu()})),$("#menu-copylink").on("click",rm.copyLink),$("#menu-copyimg").on("click",(function(){rm.writeClipImg(domImgSrc)})),$("#menu-downloadimg").on("click",(function(){rm.downloadImage(domImgSrc,"MeuiCat")})),$("#menu-copylinkimg").on("click",(function(){rm.CopyLinkImg(domImgSrc)})),$("#menu-randomPost").on("click",(function(){rm.hideRightMenu(),toRandomPost()})),$("#menu-translate").on("click",rm.translate),$("#menu-asidehide").on("click",rm.hideAsideBtn)},selceText:function(){var e;e=document.selection?document.selection.createRange().text:window.getSelection()+"",selectTextNow=e||""}};window.oncontextmenu=function(e){if(document.body.clientWidth>768){let t=e.clientX+10,n=e.clientY,o=$(".rightMenuPost"),i=$(".rightMenuOther"),a=$(".rightMenuPlugin"),c=$("#menu-commentBarrage"),m=$("#menu-copytext"),r=$("#menu-pastetext"),d=$("#menu-commenttext"),h=$("#menu-search"),s=$("#menu-searchBaidu"),u=$("#menu-newwindow"),l=$("#menu-copylink"),g=$("#menu-copyimg"),w=$("#menu-downloadimg"),p=$("#menu-copylinkimg"),f=e.target.href,b=e.target.currentSrc,k=!1;return i.show(),globalEvent=e,selectTextNow&&window.getSelection()?(k=!0,m.show(),$("#post-comment").length?d.show():d.hide(),h.show(),s.show(),o.hide()):(m.hide(),d.hide(),h.hide(),s.hide()),f?(k=!0,u.show(),l.show(),domhref=f,o.hide()):(u.hide(),l.hide()),b?(k=!0,g.show(),w.show(),p.show(),domImgSrc=b,o.hide()):(g.hide(),w.hide(),p.hide()),"input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase()?(k=!0,r.show(),o.hide()):r.hide(),k?(i.hide(),a.show()):(a.hide(),$("#body-wrap.post").length?o.show():o.hide()),$(".read-mode").length?c.hide():c.show(),rm.reloadrmSize(),t+rmWidth>window.innerWidth&&(t-=rmWidth+10),n+rmHeight>window.innerHeight&&(n-=n+rmHeight-window.innerHeight),rm.showRightMenu(!0,n,t),$("#rightMenu-mask").attr("style","display: flex"),!1}},document.onmouseup=document.ondbclick=icat.selceText;let rm={showRightMenu:function(e,t=0,n=0){let o=$("#rightMenu");o.css("top",t+"px").css("left",n+"px"),e?(o.show(),icat.stopMaskScroll()):o.hide()},hideRightMenu:function(){rm.showRightMenu(!1),$("#rightMenu-mask").attr("style","display: none")},reloadrmSize:function(){rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height()},switchDarkMode:function(){"light"===("dark"===document.documentElement.getAttribute("data-theme")?"dark":"light")?(activateDarkMode(),saveToLocal.set("theme","dark",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night),"/charts/"==location.pathname&&(postsChart(),tagsChart(),categoriesChart())):(activateLightMode(),saveToLocal.set("theme","light",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day),"/charts/"==location.pathname&&(postsChart(),tagsChart(),categoriesChart())),"function"==typeof utterancesTheme&&utterancesTheme(),"object"==typeof FB&&window.loadFBComment(),window.DISQUS&&document.getElementById("disqus_thread").children.length&&setTimeout((()=>window.disqusReset()),200),rm.hideRightMenu()},switchReadMode:function(){const e=document.body;if(0===$(".read-mode").length){e.classList.add("read-mode");const t=document.createElement("button");t.type="button",t.className="iconfont icat-exit-mode exit-readmode",e.appendChild(t);const n=()=>{e.classList.remove("read-mode"),t.remove(),t.removeEventListener("click",n)};t.addEventListener("click",n),$("#menu-reading span").text("退出阅读模式")}else e.classList.remove("read-mode"),$(".exit-readmode").remove(),$("#menu-reading span").text("阅读模式");rm.hideRightMenu()},switchCommentBarrage:function(){document.querySelector(".comment-barrage")&&($(".comment-barrage").is(":visible")?($(".comment-barrage").hide(),$("#menu-commentBarrage span").text("显示热评"),document.querySelector("#consoleCommentBarrage").classList.remove("on"),localStorage.setItem("commentBarrageSwitch","false")):$(".comment-barrage").is(":hidden")&&($(".comment-barrage").show(),$("#menu-commentBarrage span").text("关闭热评"),document.querySelector("#consoleCommentBarrage").classList.add("on"),localStorage.removeItem("commentBarrageSwitch"))),rm.hideRightMenu()},copyUrl:function(e){$("body").after("<input id='copyVal'></input>");var t=e,n=document.getElementById("copyVal");n.value=t,n.select(),n.setSelectionRange(0,n.value.length),document.execCommand("copy"),$("#copyVal").remove()},copyPostUrl:function(){var e=window.location.href;rm.copyUrl(e),btf.snackbarShow("复制本页链接地址成功",!1,2e3),rm.hideRightMenu()},rightmenuCopyText:function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},readClipboard:function(){navigator.clipboard&&navigator.clipboard.readText().then((e=>rm.insertAtCaret(globalEvent.target,e)))},insertAtCaret:function(e,t){const n=e.selectionStart,o=e.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(n||"0"==n){var i=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=i}else e.value+=t,e.focus()},pasteText:function(){rm.readClipboard(),rm.hideRightMenu()},searchBaidu:function(){btf.snackbarShow("即将跳转到百度搜索",!1,2e3),setTimeout((function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)}),"2000"),rm.hideRightMenu()},rightmenuCopyText:function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},copyLink:function(){rm.rightmenuCopyText(domhref),btf.snackbarShow("已复制链接地址")},downloadimging:!1,writeClipImg:function(e){const t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?0:1e4;rm.hideRightMenu(),btf.snackbarShow("正在下载中，请稍后",!1,t),0==rm.downloadimging&&(rm.downloadimging=!0,setTimeout((function(){icat.copyImage(e),btf.snackbarShow("复制成功！图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1}),"2000"))},downloadImage:function(e,t){rm.hideRightMenu(),0==rm.downloadimging?(rm.downloadimging=!0,btf.snackbarShow("正在下载中，请稍后",!1,1e4),setTimeout((function(){let n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){let e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0,n.width,n.height);let o=e.toDataURL("image/png"),i=document.createElement("a"),a=new MouseEvent("click");i.download=t||"photo",i.href=o,i.dispatchEvent(a)},n.src=e,btf.snackbarShow("图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1}),"10000")):btf.snackbarShow("有正在进行中的下载，请稍后再试")},CopyLinkImg:function(e){rm.rightmenuCopyText(e),btf.snackbarShow("已复制图片链接")},translate:function(){rm.hideRightMenu(),document.getElementById("translateLink").click()},hideAsideBtn:function(){const e=document.documentElement.classList,t=e.contains("hide-aside")?"show":"hide";saveToLocal.set("aside-status",t,2),e.toggle("hide-aside"),rm.hideRightMenu()}};function whenDOMReady(){"/privacy/"==location.pathname&&meuicat.addScript("ua-ip","https://cdn.meuicat.com/gh/UAParser.js/ua-parser.min.js",meuicat.getIpInfo()),meuicat.comments(),meuicat.tagsBarActive(),meuicat.wowanimation(),meuicat.toggleinit(),meuicat.initEssay(),icat.addRightMenuClickEvent(),"/photos/"==location.pathname&&meuicat.photos(),"/album/"==location.pathname&&meuicat.photos("旅途"),("/"==location.pathname||location.pathname.startsWith("/page/"))&&(meuicat.listenToPageInputPress(),meuicat.homeplatform(),meuicat.Tagscolor(),meuicat.swiper(),meuicat.RandomPosts()),location.pathname.startsWith("/blog/")&&(meuicat.post_cover(),meuicat.postplatform(),meuicat.postai()),location.pathname.startsWith("/about/")&&(meuicat.Introduction(),meuicat.runtimen(),meuicat.fiftyonela()),"/essay/"==location.pathname&&setTimeout((()=>{meuicat.changeTime(),btf.loadLightbox(document.querySelectorAll("#icat-bber img")),window.lazyLoadInstance&&window.lazyLoadInstance.update(),meuicat.percent(),meuicat.reflashWaterFall()}),500),document.getElementById("post-comment")&&meuicat.owoBig()}whenDOMReady(),document.addEventListener("pjax:complete",whenDOMReady),window.onresize=()=>{waterfall("#waterfall")},meuicat.logInfo(),meuicat.MemorialDay(),window.onscroll=meuicat.percent;