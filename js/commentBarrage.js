var postCommentElement=document.getElementById("post-comment");if(postCommentElement){var commentBarrageConfig={maxBarrage:1,barrageTime:4e3,twikooUrl:"https://twikoo.meuicat.com/",accessToken:"091e76c30b8bb8bc672808816ceb87e2",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,dom:document.querySelector(".comment-barrage")},commentInterval=null,hoverOnCommentBarrage=!1;function initCommentBarrage(){var e=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":commentBarrageConfig.accessToken,url:commentBarrageConfig.pageUrl}),r=new XMLHttpRequest;r.withCredentials=!0,r.addEventListener("readystatechange",(function(){4===this.readyState&&(commentBarrageConfig.barrageList=commentLinkFilter(JSON.parse(this.responseText).data),commentBarrageConfig.dom.innerHTML="")})),r.open("POST",commentBarrageConfig.twikooUrl),r.setRequestHeader("Content-Type","application/json"),r.send(e),clearInterval(commentInterval),commentInterval=null,commentInterval=setInterval((()=>{commentBarrageConfig.barrageList.length&&!hoverOnCommentBarrage&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&!hoverOnCommentBarrage&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())}),commentBarrageConfig.barrageTime)}function commentLinkFilter(e){e.sort(((e,r)=>e.created-r.created));let r=[];return e.forEach((e=>{r.push(...getCommentReplies(e))})),r}function getCommentReplies(e){if(e.replies){let r=[e];return e.replies.forEach((e=>{r.push(...getCommentReplies(e))})),r}return[]}function popCommentBarrage(e){let r=document.createElement("div");commentBarrageConfig.dom.clientWidth,commentBarrageConfig.dom.clientHeight;r.className="comment-barrage-item",r.innerHTML=`\n\t\t<div class="barrageHead">\n      \t\t<a class="barrageTitle" href="javascript:meuicat.scrollTo(' rel="external nofollow noreferrer"post-comment')"">热评</a>\n\t\t\t<div class="barrageNick">${e.nick}</div>\n\t\t\t<img class="barrageAvatar" src="https://cravatar.cn/avatar/${e.mailMd5}"/>\n\t\t\t<a class="comment-barrage-close" href="javascript:rm.switchCommentBarrage()" rel="external nofollow noreferrer"><i class="iconfont icat-close"></i></a>\n\t\t</div>\n\t\t<a class="barrageContent" href="javascript:void(0);" rel="external nofollow noreferrer" onclick="javascript:meuicat.scrollTo('${e.id}');">${e.comment}</a>\n\t`,$("#menu-commentBarrage span").text("关闭热评"),commentBarrageConfig.barrageTimer.push(r),commentBarrageConfig.dom.append(r)}function removeCommentBarrage(e){e.className="comment-barrage-item out",setTimeout((()=>{commentBarrageConfig.dom.removeChild(e)}),1e3)}$(".comment-barrage").hover((function(){hoverOnCommentBarrage=!0,console.log("热评悬浮")}),(function(){hoverOnCommentBarrage=!1,console.log("停止悬浮")})),document.addEventListener("scroll",btf.throttle((function(){var e=window.scrollY+document.documentElement.clientHeight,r=(window.scrollY,document.querySelector(".comment-barrage")),t=document.getElementById("post-comment");if(t&&r){var a=t.offsetTop+t.offsetHeight/2;document.body.clientWidth>768&&(r.style.bottom=a>e?"40px":"-200px")}}),200)),initCommentBarrage(),document.addEventListener("pjax:send",(function(){clearInterval(commentInterval)}))}